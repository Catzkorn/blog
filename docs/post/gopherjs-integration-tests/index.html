<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">

  <title>GopherJS Integration Tests</title>
  <meta property="og:title" content="GopherJS Integration Tests" />
  <meta name="twitter:title" content="GopherJS Integration Tests" />
  <meta name="description" content="With friends Qunit, Ginkgo and Agouti">
  <meta property="og:description" content="With friends Qunit, Ginkgo and Agouti">
  <meta name="twitter:description" content="With friends Qunit, Ginkgo and Agouti">
  <meta name="author" content="Johan Brandhorst"/>
  <link href='https://jbrandhorst.com/img/favicon.ico' rel='icon' type='image/x-icon'/>
  <meta property="og:image" content="https://jbrandhorst.com/img/icon.jpg" />
  <meta name="twitter:image" content="https://jbrandhorst.com/img/icon.jpg" />
  <meta name="twitter:card" content="summary" />
  <meta name="twitter:site" content="@JohanBrandhorst" />
  <meta name="twitter:creator" content="@JohanBrandhorst" />
  <meta property="og:url" content="https://jbrandhorst.com/post/gopherjs-integration-tests/" />
  <meta property="og:type" content="website" />
  <meta property="og:site_name" content="Go Ahead" />

  <meta name="generator" content="Hugo 0.21" />
  <link rel="canonical" href="https://jbrandhorst.com/post/gopherjs-integration-tests/" />
  <link rel="alternate" href="https://jbrandhorst.com/index.xml" type="application/rss+xml" title="Go Ahead">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.7.1/katex.min.css" integrity="sha384-wITovz90syo1dJWVh32uuETPVEtGigN07tkttEqPv+uR2SE/mbQcG7ATL28aI9H0" crossorigin="anonymous">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" />
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
  <link rel="stylesheet" href="https://jbrandhorst.com/css/main.css" />
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic" />
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800" />
  <link rel="stylesheet" href="https://jbrandhorst.com/css/pygment_highlights.css" />
  <link rel="stylesheet" href="https://jbrandhorst.com/css/highlight.min.css" />

<script>
window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
ga('create', 'UA-96154465-1', 'auto');
ga('send', 'pageview');
</script>
<script async src='//www.google-analytics.com/analytics.js'></script>

</head>

  <body>
    <nav class="navbar navbar-default navbar-fixed-top navbar-custom">
  <div class="container-fluid">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#main-navbar">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="https://jbrandhorst.com">Go Ahead</a>
    </div>

    <div class="collapse navbar-collapse" id="main-navbar">
      <ul class="nav navbar-nav navbar-right">
        
          
            <li>
              <a title="Blog" href="https://jbrandhorst.com/">Blog</a>
            </li>
          
        
          
            <li>
              <a title="About" href="https://jbrandhorst.com/page/about/">About</a>
            </li>
          
        
          
            <li>
              <a title="Tags" href="https://jbrandhorst.com/tags">Tags</a>
            </li>
          
        

        

        
      </ul>
    </div>

    <div class="avatar-container">
      <div class="avatar-img-border">
        
          <a title="Go Ahead" href="https://jbrandhorst.com">
            <img class="avatar-img" src="https://jbrandhorst.com/img/icon.jpg" alt="Go Ahead" />
          </a>
        
      </div>
    </div>

  </div>
</nav>




    
  
  
  




  

  <header class="header-section ">
    
    <div class="intro-header no-img">
      
      <div class="container">
        <div class="row">
          <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
            <div class="post-heading">
              <h1>GopherJS Integration Tests</h1>
                
                  
                    <h2 class="post-subheading">With friends Qunit, Ginkgo and Agouti</h2>
                  
                
                
                  <span class="post-meta">
  Posted on July 11, 2017
  
</span>


                
            </div>
          </div>
        </div>
      </div>
    </div>
  </header>


    
<div class="container">
  <div class="row">
    <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
      <article role="main" class="blog-post">
        

<p>Recently I found myself wondering how I was going to test my new
<a href="https://jbrandhorst.com/post/gopherjs-grpcweb">GopherJS gRPC-Web bindings</a>.
Writing tests was something I had been
waiting with until I had something working, mostly because I had
no idea how I was going to meaningfully test GopherJS code that
relies on interactions with JS and the reponses of a server.</p>

<p>I have in the past made a small contribution to the
<a href="https://github.com/gopherjs/websocket">GopherJS websocket repo</a>, and found myself
impressed with the extensive tests written for the repo.
It uses <a href="https://qunitjs.com/">QUnit</a> and the <a href="github.com/rusco/qunit">GopherJS QUnit bindings</a>.
Unfortunately it appears it the bindings were written for QUnit 1.5,
which is quite old, but it does fine for a basic unit testing framework.</p>

<h2 id="the-journey-starts">The journey starts</h2>

<p>I sat about writing some QUnit tests and found the experience pretty
spartan but good enough for my purposes. After writing some tests and
wiring up the GopherJS client to be hosted by my server, navigating
to the hosted page gives you a screen that looks like this:</p>

<p><img src="https://jbrandhorst.com/img/tests.jpg" alt="QUnit Results Page" /></p>

<p>Yay all tests pass! We could leave it here and just tell ourselves that
we&rsquo;ll run the tests every time we add something, no problem. But I was
still not happy that this required a manual step every time we wanted
to verify the code. I wanted to find some way to automate the step
that is currently manual, that is, navigate to the page and check that
there are no errors.</p>

<h2 id="enter-agouti">Enter Agouti</h2>

<p>I&rsquo;ve had dealings with various WebDrivers before, but I hadn&rsquo;t yet had
to solve the problem of parsing a web page in a Go context. I had seen
<a href="http://agouti.org/">Agouti</a> in passing before when browsing the official
web page of the test framework we use at work - <a href="http://onsi.github.io/ginkgo/">Ginkgo</a>.
Here was a Ginkgo compatible test framework that could solve my problem!
I of course jumped at the chance to try it.</p>

<p>Working with Agouti is simple if you&rsquo;ve ever used a WebDriver before,
all the usual <code>FindByX</code> are there, and it&rsquo;s also got cool Gomega matchers
like <code>HasText()</code> and <code>BeFound()</code>. All I needed to do was write the code
to open the browser to <code>https://localhost:10000</code> where my QUnit tests
were being hosted by the server, then do a little bit of parsing of the
page to find out whether any tests had failed, and then fail the Agouti
test based on that.</p>

<p>I also spent a little time on writing out the errors produced by QUnit
for a couple of different error types so that I would get a more helpful
message than just &ldquo;Tests failed!&rdquo; if there was a test failure.</p>

<p>I ended up with a test suite that starts the server hosting the GopherJS,
spins up a chrome browser window via <code>chromedriver</code>, navigates to the page,
grabs the JS rendered DOM content, parses parts of it to see whether any tests failed,
and reports the result. All now done via one single command.</p>

<p><video src="https://jbrandhorst.com/img/tests.webm" width="700" preload="metadata" controls muted/></p>

<p>Of course - the best part about this is that Agouti can be made to run with any
WebDriver compatible browser client, so Selenium, PhantomJS etc can be plugged in
in place of chromedriver. Free compatibility testing!</p>

<h2 id="wrapping-up">Wrapping up</h2>

<p>I&rsquo;ve introduced the GopherJS QUnit bindings and Agouti, two packages that make
it a breeze to confidently test your GopherJS packages. The source for all this
is available <a href="https://github.com/johanbrandhorst/protobuf/tree/master/test">on my github</a>,
feel free to take a look!</p>

<p>If you enjoyed this blog post, have any questions or input,
don&rsquo;t hesitate to contact me on
<a href="https://twitter.com/JohanBrandhorst">@johanbrandhorst</a> or
under <code>jbrandhorst</code> on the Gophers Slack. I&rsquo;d love to hear
your thoughts!</p>

      </article>

      <div class="addthis_inline_share_toolbox"></div>

      <ul class="pager blog-pager">
        
          <li class="previous">
            <a href="https://jbrandhorst.com/post/gopherjs-grpcweb/" data-toggle="tooltip" data-placement="top" title="gRPC-Web with GopherJS">&larr; Previous Post</a>
          </li>
        
        
      </ul>

      
        
      

    </div>
  </div>
</div>

    <footer>
  <div class="container">
    <div class="row">
      <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
        <ul class="list-inline text-center footer-links">
          
              <li>
                <a href="https://github.com/johanbrandhorst" title="GitHub">
                  <span class="fa-stack fa-lg">
                    <i class="fa fa-circle fa-stack-2x"></i>
                    <i class="fa fa-github fa-stack-1x fa-inverse"></i>
                  </span>
                </a>
              </li>
              <li>
                <a href="https://twitter.com/JohanBrandhorst" title="Twitter">
                  <span class="fa-stack fa-lg">
                    <i class="fa fa-circle fa-stack-2x"></i>
                    <i class="fa fa-twitter fa-stack-1x fa-inverse"></i>
                  </span>
                </a>
              </li>
              <li>
                <a href="https://linkedin.com/in/johan-brandhorst-satzkorn-aa318220" title="LinkedIn">
                  <span class="fa-stack fa-lg">
                    <i class="fa fa-circle fa-stack-2x"></i>
                    <i class="fa fa-linkedin fa-stack-1x fa-inverse"></i>
                  </span>
                </a>
              </li>
          
          <li>
            <a href="https://jbrandhorst.com/index.xml" title="RSS">
              <span class="fa-stack fa-lg">
                <i class="fa fa-circle fa-stack-2x"></i>
                <i class="fa fa-rss fa-stack-1x fa-inverse"></i>
              </span>
            </a>
          </li>
          
        </ul>
        <p class="credits copyright text-muted">
          Johan Brandhorst
          &nbsp;&bull;&nbsp;
          2017

          
            &nbsp;&bull;&nbsp;
            <a href="https://jbrandhorst.com">Go Ahead</a>
          
        </p>
        
        <p class="credits theme-by text-muted">
          <a href="http://gohugo.io">Hugo v0.21</a> powered &nbsp;&bull;&nbsp; <a href="https://github.com/halogenica/beautifulhugo">Beautiful Hugo</a> &nbsp;&bull;&nbsp; Thanks to <a href="https://netlify.com">Netlify.com</a> for hosting my blog!
          
        </p>
      </div>
    </div>
  </div>
</footer>

<script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.7.1/katex.min.js" integrity="sha384-/y1Nn9+QQAipbNQWU65krzJralCnuOasHncUFXGkdwntGeSvQicrYkiUBwsgUqc1" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.7.1/contrib/auto-render.min.js" integrity="sha384-dq1/gEHSxPZQ7DdrM82ID4YVol9BYyU7GbWlIwnwyPzotpoc57wDw/guX8EaYGPx" crossorigin="anonymous"></script>
<script src="https://code.jquery.com/jquery-1.12.4.min.js" integrity="sha256-ZosEbRLbNQzLpnKIkEdrPv7lOy9C27hHQ+Xp8a4MxAQ=" crossorigin="anonymous"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
<script src="https://jbrandhorst.com/js/main.js"></script>
<script src="https://jbrandhorst.com/js/highlight.min.js"></script>
<script> hljs.initHighlightingOnLoad(); </script>
<script> renderMathInElement(document.body); </script>



<script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-593054e035fc0c92" async></script>


  </body>
</html>

