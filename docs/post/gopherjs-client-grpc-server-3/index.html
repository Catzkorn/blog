<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
    
    <title>GopherJS Client and gRPC Server - Part 3</title>
    <meta property="og:title" content="GopherJS Client and gRPC Server - Part 3" />
    <meta name="twitter:title" content="GopherJS Client and gRPC Server - Part 3" />
    <meta name="description" content="A guide to implementing a GopherJS frontend to a gRPC backend exposed over HTTP via the gRPC-gateway">
    <meta property="og:description" content="A guide to implementing a GopherJS frontend to a gRPC backend exposed over HTTP via the gRPC-gateway">
    <meta name="twitter:description" content="A guide to implementing a GopherJS frontend to a gRPC backend exposed over HTTP via the gRPC-gateway">
    <meta name="author" content="Johan Brandhorst" />
    <link href='https://jbrandhorst.com/img/favicon.ico' rel='icon' type='image/x-icon' />
    <meta property="og:image" content="https://jbrandhorst.com/img/icon.jpg" />
    <meta name="twitter:image" content="https://jbrandhorst.com/img/icon.jpg" />
    <meta name="twitter:card" content="summary" />
    <meta name="twitter:site" content="@JohanBrandhorst" />
    <meta name="twitter:creator" content="@JohanBrandhorst" />
    <meta property="og:url" content="https://jbrandhorst.com/post/gopherjs-client-grpc-server-3/" />
    <meta property="og:type" content="website" />
    <meta property="og:site_name" content="Go Ahead" />
    
    <meta name="generator" content="Hugo 0.28" />
    <link rel="canonical" href="https://jbrandhorst.com/post/gopherjs-client-grpc-server-3/" />
    <link rel="alternate" href="https://jbrandhorst.com/%20index.xml%20" type="application/rss+xml" title="Go Ahead">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.7.1/katex.min.css" integrity="sha384-wITovz90syo1dJWVh32uuETPVEtGigN07tkttEqPv+uR2SE/mbQcG7ATL28aI9H0"
        crossorigin="anonymous">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" />
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u"
        crossorigin="anonymous">
    <link rel="stylesheet" href="https://jbrandhorst.com/%20css/main.css%20" />
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Lora:400,700,400italic,700italic" />
    <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,800italic,400,300,600,700,800"
    /> 
<script>
window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
ga('create', 'UA-96154465-1', 'auto');
ga('send', 'pageview');
</script>
<script async src='//www.google-analytics.com/analytics.js'></script>

</head>

  <body>
    <nav class="navbar navbar-default navbar-fixed-top navbar-custom">
  <div class="container-fluid">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#main-navbar">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="https://jbrandhorst.com">Go Ahead</a>
    </div>

    <div class="collapse navbar-collapse" id="main-navbar">
      <ul class="nav navbar-nav navbar-right">
        
          
            <li>
              <a title="Blog" href="https://jbrandhorst.com/">Blog</a>
            </li>
          
        
          
            <li>
              <a title="About" href="https://jbrandhorst.com/page/about/">About</a>
            </li>
          
        
          
            <li>
              <a title="Tags" href="https://jbrandhorst.com/tags">Tags</a>
            </li>
          
        

        

        
      </ul>
    </div>

    <div class="avatar-container">
      <div class="avatar-img-border">
        
          <a title="Go Ahead" href="https://jbrandhorst.com">
            <img class="avatar-img" src="https://jbrandhorst.com/img/icon.jpg" alt="Go Ahead" />
          </a>
        
      </div>
    </div>

  </div>
</nav>




    
  
  
  




  

  <header class="header-section ">
    
    <div class="intro-header no-img">
      
      <div class="container">
        <div class="row">
          <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
            <div class="post-heading">
              <h1>GopherJS Client and gRPC Server - Part 3</h1>
                
                  
                    <h2 class="post-subheading">A guide to implementing a GopherJS frontend to a gRPC backend exposed over HTTP via the gRPC-gateway</h2>
                  
                
                
                  <span class="post-meta">
  Posted on April 13, 2017
  
</span>


                
            </div>
          </div>
        </div>
      </div>
    </div>
  </header>


    
<div class="container">
  <div class="row">
    <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
      <article role="main" class="blog-post">
        

<h2 id="implement-the-client">Implement the client</h2>

<p>GopherJS can be used in a couple of different ways, and there&rsquo;s a couple of different
bindings to many popular JavaScript frameworks.
The <a href="https://github.com/gopherjs/gopherjs/wiki/bindings">GopherJS wiki</a>
has some great resources.</p>

<p>I tried a couple of different ones and ended up using the
<a href="https://github.com/oskca/gopherjs-vue">VueJS bindings</a> because it made it easy to
prototype things quickly. I hear <a href="https://vuejs.org/">VueJS</a> works well for many JS
evangelisers out there, but I&rsquo;ve only used it with small projects. It&rsquo;ll do for this
blog post, but in the future I want to try working with
<a href="https://github.com/myitcv/react">myitcv&rsquo;s React bindings</a> and the
<a href="https://github.com/gopherjs/vecty">Vecty toolkit</a>.</p>

<p>One of the biggest problems with GopherJS at the moment is it
<a href="https://github.com/gopherjs/gopherjs/issues/136">does not have deadcode elimination</a>.
This can be remedied by avoiding many standard library packages. Throughout this I&rsquo;ve kept
minimizing generated file size a priority, to show that it&rsquo;s possible to implement
fully featured frontend apps with GopherJS without compromising on file size.</p>

<p>To make things a little saner we&rsquo;ll create a couple of folders again.
Lets add <code>compiled</code> and <code>html</code> to the <code>client</code> folder:</p>
<div class="highlight"><pre style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">$ <span style="color:#007020">cd</span> client <span style="color:#666">&amp;&amp;</span> tree -L <span style="color:#40a070">1</span> -d
.
|-- compiled
|-- html
<span style="color:#4070a0">`</span>-- protos</code></pre>
</div>
<p>Next we&rsquo;ll define the <code>HTML</code> of our page. Create <code>index.html</code> in the <code>html</code> folder.
It&rsquo;s not supposed to be anything fancy, we just want a skeleton for our GopherJS code.
The full HTML can be found on
<a href="https://github.com/johanbrandhorst/gopherjs-grpc-websocket/blob/4f15a95d84ed6e60ce70359204ce2a64c3021776/client/html/index.html">my github</a>,
but it won&rsquo;t make sense without looking at the GopherJS code!</p>

<p>Skipping out on some boilerplate, we&rsquo;ll start with the Simple button:</p>
<div class="highlight"><pre style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-html" data-lang="html">&lt;<span style="color:#062873;font-weight:bold">div</span> <span style="color:#4070a0">id</span><span style="color:#666">=</span><span style="color:#4070a0">&#34;app&#34;</span> <span style="color:#4070a0">v-cloak</span>&gt;
	&lt;<span style="color:#062873;font-weight:bold">h1</span>&gt;gRPC through gopherjs!&lt;/<span style="color:#062873;font-weight:bold">h1</span>&gt;
	&lt;<span style="color:#062873;font-weight:bold">p</span>&gt;
		&lt;<span style="color:#062873;font-weight:bold">h2</span>&gt;Simple&lt;/<span style="color:#062873;font-weight:bold">h2</span>&gt;
		&lt;<span style="color:#062873;font-weight:bold">button</span> <span style="color:#4070a0">v-if</span><span style="color:#666">=</span><span style="color:#4070a0">&#34;!simple_message&#34;</span> <span style="">@</span><span style="color:#4070a0">click</span><span style="color:#666">=</span><span style="color:#4070a0">&#34;Simple()&#34;</span>&gt;Send GET&lt;/<span style="color:#062873;font-weight:bold">button</span>&gt;
		&lt;<span style="color:#062873;font-weight:bold">div</span> <span style="color:#4070a0">v-if</span><span style="color:#666">=</span><span style="color:#4070a0">&#34;simple_message&#34;</span>&gt;
			Message: {{ simple_message.msg }}, Num: {{ simple_message.num }}
		&lt;/<span style="color:#062873;font-weight:bold">div</span>&gt;
	&lt;/<span style="color:#062873;font-weight:bold">p</span>&gt;
&lt;/<span style="color:#062873;font-weight:bold">div</span>&gt;
&lt;<span style="color:#062873;font-weight:bold">script</span> <span style="color:#4070a0">src</span><span style="color:#666">=</span><span style="color:#4070a0">&#34;index.js&#34;</span>&gt;&lt;/<span style="color:#062873;font-weight:bold">script</span>&gt;</code></pre>
</div>
<p>This creates a button with the label <code>Send GET</code>, that will, when clicked, call the
function <code>Simple</code>. There&rsquo;s also all kinds of references to things we haven&rsquo;t seen yet
so lets move on to the GopherJS code. Again, you can skip ahead and see the full code
on <a href="https://github.com/johanbrandhorst/gopherjs-grpc-websocket/blob/4f15a95d84ed6e60ce70359204ce2a64c3021776/client/client.go">my github</a>. Create <code>client.go</code> in the <code>client</code> folder.</p>
<div class="highlight"><pre style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#007020;font-weight:bold">package</span> main

<span style="color:#60a0b0;font-style:italic">//go:generate gopherjs build -m client.go -o html/index.js
</span><span style="color:#60a0b0;font-style:italic">//go:generate go-bindata -pkg compiled -nometadata -o compiled/client.go -prefix html ./html
</span><span style="color:#60a0b0;font-style:italic">//go:generate bash -c &#34;rm html/*.js*&#34;
</span><span style="color:#60a0b0;font-style:italic"></span>
<span style="color:#007020;font-weight:bold">import</span> (
	<span style="color:#4070a0">&#34;github.com/gopherjs/gopherjs/js&#34;</span>
	<span style="color:#4070a0">&#34;github.com/johanbrandhorst/gopherjs-json&#34;</span>
	<span style="color:#4070a0">&#34;github.com/oskca/gopherjs-vue&#34;</span>
	<span style="color:#4070a0">&#34;honnef.co/go/js/xhr&#34;</span>

	<span style="color:#4070a0">&#34;github.com/johanbrandhorst/gopherjs-grpc-websocket/client/helpers&#34;</span>
	<span style="color:#4070a0">&#34;github.com/johanbrandhorst/gopherjs-grpc-websocket/client/protos/server&#34;</span>
)

<span style="color:#007020;font-weight:bold">type</span> MyMessage <span style="color:#007020;font-weight:bold">struct</span> {
	<span style="color:#666">*</span>js.Object
	Msg <span style="color:#902000">string</span> <span style="color:#4070a0">`js:&#34;msg&#34;`</span>
	Num <span style="color:#902000">uint32</span> <span style="color:#4070a0">`js:&#34;num&#34;`</span>
}

<span style="color:#60a0b0;font-style:italic">// Model is the state keeper of the app.
</span><span style="color:#60a0b0;font-style:italic"></span><span style="color:#007020;font-weight:bold">type</span> Model <span style="color:#007020;font-weight:bold">struct</span> {
	<span style="color:#666">*</span>js.Object
	SimpleMessage <span style="color:#666">*</span>MyMessage   <span style="color:#4070a0">`js:&#34;simple_message&#34;`</span>
}

<span style="color:#007020;font-weight:bold">func</span> (m <span style="color:#666">*</span>Model) Simple() {
	req <span style="color:#666">:=</span> xhr.NewRequest(<span style="color:#4070a0">&#34;GET&#34;</span>, <span style="color:#4070a0">&#34;/api/v1/simple&#34;</span>)
	req.SetRequestHeader(<span style="color:#4070a0">&#34;Content-Type&#34;</span>, <span style="color:#4070a0">&#34;application/json&#34;</span>)

	<span style="color:#60a0b0;font-style:italic">// Wrap call in goroutine to use blocking code
</span><span style="color:#60a0b0;font-style:italic"></span>	<span style="color:#007020;font-weight:bold">go</span> <span style="color:#007020;font-weight:bold">func</span>() {
		<span style="color:#60a0b0;font-style:italic">// Blocks until reply received
</span><span style="color:#60a0b0;font-style:italic"></span>		err <span style="color:#666">:=</span> req.Send(<span style="color:#007020;font-weight:bold">nil</span>)
		<span style="color:#007020;font-weight:bold">if</span> err <span style="color:#666">!=</span> <span style="color:#007020;font-weight:bold">nil</span> {
			<span style="color:#007020">panic</span>(err)
		}

		<span style="color:#007020;font-weight:bold">if</span> req.Status <span style="color:#666">!=</span> <span style="color:#40a070">200</span> {
			<span style="color:#007020">panic</span>(req.ResponseText)
		}

		rObj, err <span style="color:#666">:=</span> json.Unmarshal(req.ResponseText)
		<span style="color:#007020;font-weight:bold">if</span> err <span style="color:#666">!=</span> <span style="color:#007020;font-weight:bold">nil</span> {
			<span style="color:#007020">panic</span>(err)
		}

		msg <span style="color:#666">:=</span> <span style="color:#666">&amp;</span>MyMessage{
			Object: rObj,
		}

		m.SimpleMessage = msg
	}()
}

<span style="color:#007020;font-weight:bold">func</span> main() {
	m <span style="color:#666">:=</span> <span style="color:#666">&amp;</span>Model{
		Object: js.Global.Get(<span style="color:#4070a0">&#34;Object&#34;</span>).New(),
	}

	<span style="color:#60a0b0;font-style:italic">// These must be set after the struct has been initialised
</span><span style="color:#60a0b0;font-style:italic"></span>	<span style="color:#60a0b0;font-style:italic">// so that the values can be mirrored into the internal JS Object.
</span><span style="color:#60a0b0;font-style:italic"></span>	m.SimpleMessage = <span style="color:#007020;font-weight:bold">nil</span>

	<span style="color:#60a0b0;font-style:italic">// Create the VueJS viewModel using a struct pointer
</span><span style="color:#60a0b0;font-style:italic"></span>	vue.New(<span style="color:#4070a0">&#34;#app&#34;</span>, m)
}</code></pre>
</div>
<p>There&rsquo;s quite a bit to break down here, so we&rsquo;ll start from the top.</p>

<p>GopherJS requires packages to pretend that they&rsquo;re binaries,
so we must use <code>package main</code> at the top.</p>

<p>Then we&rsquo;ve got a couple of <code>go generate</code> directives that will create and pack
the JS file so that we can easily serve it from the server later on.</p>
<div class="highlight"><pre style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#60a0b0;font-style:italic">//go:generate gopherjs build -m client.go -o html/index.js
</span><span style="color:#60a0b0;font-style:italic">//go:generate go-bindata -pkg compiled -nometadata -o compiled/client.go -prefix html ./html
</span><span style="color:#60a0b0;font-style:italic"></span><span style="color:#666">//</span><span style="color:#007020;font-weight:bold">go</span>:generate bash <span style="color:#666">-</span>c <span style="color:#4070a0">&#34;rm html/*.js*&#34;</span></code></pre>
</div>
<p>The first one will compile <code>client.go</code> file into <code>html/index.js</code>. The <code>-m</code>
flag creates a minified JS output file.</p>

<p>The second one uses the excellent <a href="https://github.com/jteeuwen/go-bindata">go-bindata</a>
to generate a convenience package for serving static content from a
Go webserver. It means we can distribute
a single binary which contains both the webserver logic and the static content.
The <code>-pkg</code> flag is the name of the package that is generated, the <code>-prefix</code> flag
removes the specified path from the path in the package. We&rsquo;ll see later how to use it.</p>

<p>The last one just removes the generated JS file. We do this because all the
data is already in the package we generated in step two and the generated JS
is just a huge unmanageable text file. Who likes looking at JS anyway ;)?</p>

<p>Then we&rsquo;ve got the <code>MyMessage</code> struct. It&rsquo;s manually crafted to correspond
to the one defined in the protofile.</p>
<div class="highlight"><pre style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#007020;font-weight:bold">type</span> MyMessage <span style="color:#007020;font-weight:bold">struct</span> {
	<span style="color:#666">*</span>js.Object
	Msg <span style="color:#902000">string</span> <span style="color:#4070a0">`js:&#34;msg&#34;`</span>
	Num <span style="color:#902000">uint32</span> <span style="color:#4070a0">`js:&#34;num&#34;`</span>
}</code></pre>
</div>
<p>The <code>js</code> struct tag tells GopherJS what the variable should be called in the JS world,
and by extension, in the <code>HTML</code>. So when we look back at the <code>HTML</code> we
defined it should now be clearer how things work.</p>

<p>Next up we&rsquo;ve got the <code>Model</code>.</p>
<div class="highlight"><pre style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#60a0b0;font-style:italic">// Model is the state keeper of the app.
</span><span style="color:#60a0b0;font-style:italic"></span><span style="color:#007020;font-weight:bold">type</span> Model <span style="color:#007020;font-weight:bold">struct</span> {
	<span style="color:#666">*</span>js.Object
	SimpleMessage <span style="color:#666">*</span>MyMessage   <span style="color:#4070a0">`js:&#34;simple_message&#34;`</span>
}</code></pre>
</div>
<p>Any Go structs that we want to use with JS need to embed the GopherJS <code>*js.Object</code> type.
<a href="https://github.com/gopherjs/gopherjs/wiki/JavaScript-Tips-and-Gotchas">This is a quirk of GopherJS</a>,
we&rsquo;ll see more later about what it means.</p>

<p>The <code>Model</code> is required by the <code>VueJS</code> bindings, and is how we communicate between the Go
world and the <code>HTML</code>. Anything we assign to properties on the <code>Model</code> will be reflected
in the <code>HTML</code> and all methods defined on the <code>Model</code> are accessible from the <code>HTML</code>.</p>
<div class="highlight"><pre style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-html" data-lang="html">&lt;<span style="color:#062873;font-weight:bold">p</span>&gt;
	&lt;<span style="color:#062873;font-weight:bold">h2</span>&gt;Simple&lt;/<span style="color:#062873;font-weight:bold">h2</span>&gt;
	&lt;<span style="color:#062873;font-weight:bold">button</span> <span style="color:#4070a0">v-if</span><span style="color:#666">=</span><span style="color:#4070a0">&#34;!simple_message&#34;</span> <span style="">@</span><span style="color:#4070a0">click</span><span style="color:#666">=</span><span style="color:#4070a0">&#34;Simple()&#34;</span>&gt;Send GET&lt;/<span style="color:#062873;font-weight:bold">button</span>&gt;
	&lt;<span style="color:#062873;font-weight:bold">div</span> <span style="color:#4070a0">v-if</span><span style="color:#666">=</span><span style="color:#4070a0">&#34;simple_message&#34;</span>&gt;
		Message: {{ simple_message.msg }}, Num: {{ simple_message.num }}
	&lt;/<span style="color:#062873;font-weight:bold">div</span>&gt;
&lt;/<span style="color:#062873;font-weight:bold">p</span>&gt;</code></pre>
</div>
<p>I&rsquo;m a little unhappy about keeping logic in the markup, especially when it means using
JS logic, but it&rsquo;ll do for this short introduction. So we show the button if <code>simple_message</code>
is unpopulated, otherwise we display the contents of the <code>simple_message</code>.</p>

<p>Next up we&rsquo;ve got the definition of the <code>Simple</code> function.</p>
<div class="highlight"><pre style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#007020;font-weight:bold">func</span> (m <span style="color:#666">*</span>Model) Simple() {
	req <span style="color:#666">:=</span> xhr.NewRequest(<span style="color:#4070a0">&#34;GET&#34;</span>, <span style="color:#4070a0">&#34;/api/v1/simple&#34;</span>)
	req.SetRequestHeader(<span style="color:#4070a0">&#34;Content-Type&#34;</span>, <span style="color:#4070a0">&#34;application/json&#34;</span>)

	<span style="color:#60a0b0;font-style:italic">// Wrap call in goroutine to use blocking code
</span><span style="color:#60a0b0;font-style:italic"></span>	<span style="color:#007020;font-weight:bold">go</span> <span style="color:#007020;font-weight:bold">func</span>() {
		<span style="color:#60a0b0;font-style:italic">// Blocks until reply received
</span><span style="color:#60a0b0;font-style:italic"></span>		err <span style="color:#666">:=</span> req.Send(<span style="color:#007020;font-weight:bold">nil</span>)
		<span style="color:#007020;font-weight:bold">if</span> err <span style="color:#666">!=</span> <span style="color:#007020;font-weight:bold">nil</span> {
			<span style="color:#007020">panic</span>(err)
		}

		<span style="color:#007020;font-weight:bold">if</span> req.Status <span style="color:#666">!=</span> <span style="color:#40a070">200</span> {
			<span style="color:#007020">panic</span>(req.ResponseText)
		}

		rObj, err <span style="color:#666">:=</span> json.Unmarshal(req.ResponseText)
		<span style="color:#007020;font-weight:bold">if</span> err <span style="color:#666">!=</span> <span style="color:#007020;font-weight:bold">nil</span> {
			<span style="color:#007020">panic</span>(err)
		}

		msg <span style="color:#666">:=</span> <span style="color:#666">&amp;</span>MyMessage{
			Object: rObj,
		}

		m.SimpleMessage = msg
	}()
}</code></pre>
</div>
<p>We&rsquo;ll use the excellent <a href="https://godoc.org/honnef.co/go/js/xhr">xhr</a> package for
interacting with the API the server exposes. Using the <code>xhr</code> library means we can
avoid importing <code>net/http</code> which adds 3MB to the generated JS file size.</p>

<p>Another quirk of GopherJS is that blocking code must be wrapped in a goroutine,
this is apparently because JS cannot contain blocking code.
You can find more information about this quirk in the
<a href="https://github.com/gopherjs/gopherjs#goroutines">GopherJS README</a>.</p>

<p>As you can probably see, we&rsquo;re using <code>panic</code> quite liberally in this code,
compared to how it would be used in real Go code. A <code>panic</code> in GopherJS
will dump the stack to the browser console, which is fine for
something simple like this, but in a real app you might want to capture the
error produced and assign it to something in the <code>Model</code> to make it visible
to the user.</p>

<p>Next we use <a href="https://github.com/johanbrandhorst/gopherjs-json">a simple json helper library</a>
to create a GopherJS <code>*js.Object</code> from the <code>JSON</code> string the server responds with. Because
we know the <code>JSON</code> is of the type <code>MyMessage</code>, we can use the <code>*js.Object</code>
returned to intialise a new <code>MyMessage</code> from the object,
and use that to update the <code>Model</code>. Simple!</p>

<p>Lastly we&rsquo;ve got the <code>main</code> boilerplate:</p>
<div class="highlight"><pre style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#007020;font-weight:bold">func</span> main() {
	m <span style="color:#666">:=</span> <span style="color:#666">&amp;</span>Model{
		Object: js.Global.Get(<span style="color:#4070a0">&#34;Object&#34;</span>).New(),
	}

	<span style="color:#60a0b0;font-style:italic">// These must be set after the struct has been initialised
</span><span style="color:#60a0b0;font-style:italic"></span>	<span style="color:#60a0b0;font-style:italic">// so that the values can be mirrored into the internal JS Object.
</span><span style="color:#60a0b0;font-style:italic"></span>	m.SimpleMessage = <span style="color:#007020;font-weight:bold">nil</span>

	<span style="color:#60a0b0;font-style:italic">// Create the VueJS viewModel using a struct pointer
</span><span style="color:#60a0b0;font-style:italic"></span>	vue.New(<span style="color:#4070a0">&#34;#app&#34;</span>, m)
}</code></pre>
</div>
<p>Whenever we create a GopherJS struct, a new <code>*js.Object</code> needs to be assigned to it.
Any properties on the GopherJS structs need to be initialized after the object
has been assigned to it. Note that we must <em>explicitly</em> initialize properties on
the <code>Model</code>, in order for the value to be reflected in the underlying
<code>*js.Object</code>. This is just another quirk of GopherJS.</p>

<p>We use the <code>VueJS bindings</code> to create the app. The first parameter is the identifier
of the element in the <code>HTML</code> which we want to populate the app with.</p>

<p>We&rsquo;ve got just enough here for a minimal GopherJS frontend to a grpc-gateway proxied
Go gRPC server. But we&rsquo;re still missing the really interesting stuff! Lets implement the
unary streaming function as well:</p>
<div class="highlight"><pre style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-html" data-lang="html">&lt;<span style="color:#062873;font-weight:bold">p</span>&gt;
    &lt;<span style="color:#062873;font-weight:bold">h2</span>&gt;Unary&lt;/<span style="color:#062873;font-weight:bold">h2</span>&gt;
    &lt;<span style="color:#062873;font-weight:bold">button</span> <span style="color:#4070a0">v-if</span><span style="color:#666">=</span><span style="color:#4070a0">&#34;unary_messages.length == 0&#34;</span> <span style="">@</span><span style="color:#4070a0">click</span><span style="color:#666">=</span><span style="color:#4070a0">&#34;Unary()&#34;</span>&gt;Send GET&lt;/<span style="color:#062873;font-weight:bold">button</span>&gt;
    &lt;<span style="color:#062873;font-weight:bold">div</span> <span style="color:#4070a0">v-if</span><span style="color:#666">=</span><span style="color:#4070a0">&#34;unary_messages&#34;</span>&gt;
        &lt;<span style="color:#062873;font-weight:bold">div</span> <span style="color:#4070a0">v-for</span><span style="color:#666">=</span><span style="color:#4070a0">&#34;msg in unary_messages&#34;</span>&gt;
            Message: {{ msg.msg }}, Num: {{ msg.num }}
        &lt;/<span style="color:#062873;font-weight:bold">div</span>&gt;
    &lt;/<span style="color:#062873;font-weight:bold">div</span>&gt;
&lt;/<span style="color:#062873;font-weight:bold">p</span>&gt;</code></pre>
</div>
<p>This is very similar to the simple one, but we iterate over the messages as they come in.
Next we need to add something to the model, to display the unary messages.</p>
<div class="highlight"><pre style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#007020;font-weight:bold">type</span> Model <span style="color:#007020;font-weight:bold">struct</span> {
	<span style="color:#666">...</span>
	UnaryMessages []<span style="color:#666">*</span>MyMessage <span style="color:#4070a0">`js:&#34;unary_messages&#34;`</span>
}</code></pre>
</div>
<p>We&rsquo;ll need to initialize the new struct member in the <code>main</code> function as well.</p>
<div class="highlight"><pre style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#007020;font-weight:bold">func</span> main() {
	<span style="color:#666">...</span>
	m.UnaryMessages = []<span style="color:#666">*</span>MyMessage{}
	<span style="color:#666">...</span>
}</code></pre>
</div>
<p>Now we can implement the <code>Unary</code> streaming function.</p>
<div class="highlight"><pre style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#007020;font-weight:bold">func</span> getStreamMessage(msg <span style="color:#902000">string</span>) <span style="color:#666">*</span>MyMessage {
	rObj, err <span style="color:#666">:=</span> json.Unmarshal(msg)
	<span style="color:#007020;font-weight:bold">if</span> err <span style="color:#666">!=</span> <span style="color:#007020;font-weight:bold">nil</span> {
		<span style="color:#007020">panic</span>(err)
	}

	<span style="color:#60a0b0;font-style:italic">// The actual message is wrapped in a &#34;result&#34; key,
</span><span style="color:#60a0b0;font-style:italic"></span>	<span style="color:#60a0b0;font-style:italic">// and there might be an error returned as well.
</span><span style="color:#60a0b0;font-style:italic"></span>	<span style="color:#60a0b0;font-style:italic">// See https://github.com/grpc-ecosystem/grpc-gateway/blob/b75dbe36289963caa453a924bd92ddf68c3f2a62/runtime/handler.go#L163
</span><span style="color:#60a0b0;font-style:italic"></span>	aux <span style="color:#666">:=</span> <span style="color:#666">&amp;</span><span style="color:#007020;font-weight:bold">struct</span> {
		<span style="color:#666">*</span>js.Object
		msg <span style="color:#666">*</span>MyMessage <span style="color:#4070a0">`js:&#34;result&#34;`</span>
	}{
		Object: rObj,
	}

	<span style="color:#60a0b0;font-style:italic">// The most reliable way I&#39;ve found to check whether
</span><span style="color:#60a0b0;font-style:italic"></span>	<span style="color:#60a0b0;font-style:italic">// an error was returned.
</span><span style="color:#60a0b0;font-style:italic"></span>	<span style="color:#007020;font-weight:bold">if</span> rObj.Get(<span style="color:#4070a0">&#34;error&#34;</span>).Bool() {
		<span style="color:#007020">panic</span>(msg)
	}

	<span style="color:#007020;font-weight:bold">return</span> aux.msg
}

<span style="color:#007020;font-weight:bold">func</span> (m <span style="color:#666">*</span>Model) Unary() {
	req <span style="color:#666">:=</span> xhr.NewRequest(<span style="color:#4070a0">&#34;GET&#34;</span>, <span style="color:#4070a0">&#34;/api/v1/unary&#34;</span>)
	req.SetRequestHeader(<span style="color:#4070a0">&#34;cache-control&#34;</span>, <span style="color:#4070a0">&#34;no-cache&#34;</span>)
	req.SetRequestHeader(<span style="color:#4070a0">&#34;Content-Type&#34;</span>, <span style="color:#4070a0">&#34;application/json&#34;</span>)

	bytesRead <span style="color:#666">:=</span> <span style="color:#40a070">0</span>
	req.AddEventListener(<span style="color:#4070a0">&#34;readystatechange&#34;</span>, <span style="color:#007020;font-weight:bold">false</span>, <span style="color:#007020;font-weight:bold">func</span>(_ <span style="color:#666">*</span>js.Object) {
		<span style="color:#007020;font-weight:bold">switch</span> req.ReadyState {
		<span style="color:#007020;font-weight:bold">case</span> xhr.Loading:
			<span style="color:#60a0b0;font-style:italic">// This whole dance is because the XHR ResponseText
</span><span style="color:#60a0b0;font-style:italic"></span>			<span style="color:#60a0b0;font-style:italic">// will contain all the messages, and we just want to read
</span><span style="color:#60a0b0;font-style:italic"></span>			<span style="color:#60a0b0;font-style:italic">// anything we havent already read
</span><span style="color:#60a0b0;font-style:italic"></span>			resp <span style="color:#666">:=</span> req.ResponseText[bytesRead:]
			bytesRead <span style="color:#666">+=</span> <span style="color:#007020">len</span>(resp)

			m.UnaryMessages = <span style="color:#007020">append</span>(m.UnaryMessages, getStreamMessage(resp))
		}
	})

	<span style="color:#60a0b0;font-style:italic">// Wrap call in goroutine to use blocking code
</span><span style="color:#60a0b0;font-style:italic"></span>	<span style="color:#007020;font-weight:bold">go</span> <span style="color:#007020;font-weight:bold">func</span>() {
		<span style="color:#60a0b0;font-style:italic">// Blocks until reply received
</span><span style="color:#60a0b0;font-style:italic"></span>		err <span style="color:#666">:=</span> req.Send(<span style="color:#007020;font-weight:bold">nil</span>)
		<span style="color:#007020;font-weight:bold">if</span> err <span style="color:#666">!=</span> <span style="color:#007020;font-weight:bold">nil</span> {
			<span style="color:#007020">panic</span>(err)
		}

		<span style="color:#007020;font-weight:bold">if</span> req.Status <span style="color:#666">!=</span> <span style="color:#40a070">200</span> {
			<span style="color:#007020">panic</span>(req.ResponseText)
		}
	}()
}</code></pre>
</div>
<p>While I&rsquo;m quite happy with the overall simplicity of this, unfortunately it&rsquo;s
very much JS in Go clothing. I haven&rsquo;t found a better way to handle periodically
updating requests. Again, the <code>xhr</code> library makes this much nicer. Unfortunately
the grotesque error check inside the handler is, as far as I can tell, unavoidable.
Hopefully most of the other stuff should be fairly self-explanatory with the comments.</p>

<p>That leaves us with the bidi-websocket streaming functions left to implement. I wanted
this to show off the capabilities of the websocket protocol, so it&rsquo;s a little more elaborate
than it probably needed to be. This&rsquo;ll be a bit of a code dump but I think most of this
should be reasonable easy to understand, given what we&rsquo;ve talked about so far.</p>
<div class="highlight"><pre style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-html" data-lang="html">&lt;<span style="color:#062873;font-weight:bold">p</span>&gt;
	&lt;<span style="color:#062873;font-weight:bold">h2</span>&gt;Bidi&lt;/<span style="color:#062873;font-weight:bold">h2</span>&gt;
	&lt;<span style="color:#062873;font-weight:bold">div</span> <span style="color:#4070a0">v-if</span><span style="color:#666">=</span><span style="color:#4070a0">&#34;!ws_conn&#34;</span>&gt;
		&lt;<span style="color:#062873;font-weight:bold">button</span> <span style="">@</span><span style="color:#4070a0">click</span><span style="color:#666">=</span><span style="color:#4070a0">&#34;Connect()&#34;</span>&gt;Connect to Websocket&lt;/<span style="color:#062873;font-weight:bold">button</span>&gt;
	&lt;/<span style="color:#062873;font-weight:bold">div</span>&gt;
	&lt;<span style="color:#062873;font-weight:bold">form</span> <span style="color:#4070a0">v-if</span><span style="color:#666">=</span><span style="color:#4070a0">&#34;ws_conn&#34;</span> <span style="color:#4070a0">v-on:submit</span><span style="">.</span><span style="color:#4070a0">prevent</span>&gt;
		&lt;<span style="color:#062873;font-weight:bold">input</span> <span style="color:#4070a0">type</span><span style="color:#666">=</span><span style="color:#4070a0">&#34;text&#34;</span> <span style="color:#4070a0">v-model</span><span style="color:#666">=</span><span style="color:#4070a0">&#34;input_message&#34;</span>&gt;&lt;/<span style="color:#062873;font-weight:bold">input</span>&gt;
		&lt;<span style="color:#062873;font-weight:bold">button</span> <span style="">@</span><span style="color:#4070a0">click</span><span style="color:#666">=</span><span style="color:#4070a0">&#34;Send()&#34;</span>&gt;Send Websocket message&lt;/<span style="color:#062873;font-weight:bold">button</span>&gt;
		&lt;<span style="color:#062873;font-weight:bold">button</span> <span style="">@</span><span style="color:#4070a0">click</span><span style="color:#666">=</span><span style="color:#4070a0">&#34;Close()&#34;</span>&gt;Close Websocket&lt;/<span style="color:#062873;font-weight:bold">button</span>&gt;
	&lt;/<span style="color:#062873;font-weight:bold">form</span>&gt;
	&lt;<span style="color:#062873;font-weight:bold">div</span> <span style="color:#4070a0">v-if</span><span style="color:#666">=</span><span style="color:#4070a0">&#34;bidi_messages&#34;</span>&gt;
		&lt;<span style="color:#062873;font-weight:bold">div</span> <span style="color:#4070a0">v-for</span><span style="color:#666">=</span><span style="color:#4070a0">&#34;msg in bidi_messages&#34;</span>&gt;
			Message: {{ msg.msg }}, Num: {{ msg.num }}
		&lt;/<span style="color:#062873;font-weight:bold">div</span>&gt;
	&lt;/<span style="color:#062873;font-weight:bold">div</span>&gt;
&lt;/<span style="color:#062873;font-weight:bold">p</span>&gt;</code></pre>
</div><div class="highlight"><pre style="background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#007020;font-weight:bold">type</span> Model <span style="color:#007020;font-weight:bold">struct</span> {
	<span style="color:#666">...</span>
	InputMessage  <span style="color:#902000">string</span>              <span style="color:#4070a0">`js:&#34;input_message&#34;`</span>
	BidiMessages  []<span style="color:#666">*</span>MyMessage <span style="color:#4070a0">`js:&#34;bidi_messages&#34;`</span>
	ConnOpen      <span style="color:#902000">bool</span>                <span style="color:#4070a0">`js:&#34;ws_conn&#34;`</span>
}

<span style="color:#007020;font-weight:bold">func</span> main() {
	<span style="color:#666">...</span>
	m.BidiMessages = []<span style="color:#666">*</span>MyMessage{}
	m.InputMessage = <span style="color:#4070a0">&#34;&#34;</span>
	m.ConnOpen = <span style="color:#007020;font-weight:bold">false</span>
	<span style="color:#666">...</span>
}

<span style="color:#60a0b0;font-style:italic">// GetWSBaseURL constructs the base URL for WebSocket calls
</span><span style="color:#60a0b0;font-style:italic">// Copied from
</span><span style="color:#60a0b0;font-style:italic">// https://github.com/gopherjs/websocket/blob/edfe1438a4184bea0b3f9e35fd77969061676d9c/test/test/index.go
</span><span style="color:#60a0b0;font-style:italic"></span><span style="color:#007020;font-weight:bold">func</span> GetWSBaseURL() <span style="color:#902000">string</span> {
	document <span style="color:#666">:=</span> js.Global.Get(<span style="color:#4070a0">&#34;window&#34;</span>).Get(<span style="color:#4070a0">&#34;document&#34;</span>)
	location <span style="color:#666">:=</span> document.Get(<span style="color:#4070a0">&#34;location&#34;</span>)

	wsProtocol <span style="color:#666">:=</span> <span style="color:#4070a0">&#34;ws&#34;</span>
	<span style="color:#007020;font-weight:bold">if</span> location.Get(<span style="color:#4070a0">&#34;protocol&#34;</span>).String() <span style="color:#666">==</span> <span style="color:#4070a0">&#34;https:&#34;</span> {
		wsProtocol = <span style="color:#4070a0">&#34;wss&#34;</span>
	}

	<span style="color:#007020;font-weight:bold">return</span> wsProtocol <span style="color:#666">+</span> <span style="color:#4070a0">&#34;://&#34;</span> <span style="color:#666">+</span> location.Get(<span style="color:#4070a0">&#34;hostname&#34;</span>).String() <span style="color:#666">+</span> <span style="color:#4070a0">&#34;:&#34;</span> <span style="color:#666">+</span> location.Get(<span style="color:#4070a0">&#34;port&#34;</span>).String()
}

<span style="color:#007020;font-weight:bold">func</span> (m <span style="color:#666">*</span>Model) Connect() {
	<span style="color:#60a0b0;font-style:italic">// Wrap call in goroutine to use blocking code
</span><span style="color:#60a0b0;font-style:italic"></span>	<span style="color:#007020;font-weight:bold">go</span> <span style="color:#007020;font-weight:bold">func</span>() {
		<span style="color:#60a0b0;font-style:italic">// Blocks until connection is established
</span><span style="color:#60a0b0;font-style:italic"></span>		<span style="color:#007020;font-weight:bold">var</span> err <span style="color:#902000">error</span>
		WSConn, err = websocket.Dial(GetWSBaseURL() <span style="color:#666">+</span> <span style="color:#4070a0">&#34;/api/v1/bidi&#34;</span>)
		<span style="color:#007020;font-weight:bold">if</span> err <span style="color:#666">!=</span> <span style="color:#007020;font-weight:bold">nil</span> {
			<span style="color:#007020">panic</span>(err)
		}

		m.ConnOpen = <span style="color:#007020;font-weight:bold">true</span>
	}()
}

<span style="color:#007020;font-weight:bold">func</span> (m <span style="color:#666">*</span>Model) Close() {
	err <span style="color:#666">:=</span> WSConn.Close()
	<span style="color:#007020;font-weight:bold">if</span> err <span style="color:#666">!=</span> <span style="color:#007020;font-weight:bold">nil</span> {
		<span style="color:#007020">panic</span>(err)
	}

	m.ConnOpen = <span style="color:#007020;font-weight:bold">false</span>
	m.InputMessage = <span style="color:#4070a0">&#34;&#34;</span>
	m.BidiMessages = []<span style="color:#666">*</span>MyMessage{}
}

<span style="color:#007020;font-weight:bold">func</span> (m <span style="color:#666">*</span>Model) Send() {
	msg <span style="color:#666">:=</span> <span style="color:#666">&amp;</span>MyMessage{
		Object: js.Global.Get(<span style="color:#4070a0">&#34;Object&#34;</span>).New(),
	}
	msg.Msg = m.InputMessage
	s, err <span style="color:#666">:=</span> json.Marshal(msg.Object)
	<span style="color:#007020;font-weight:bold">if</span> err <span style="color:#666">!=</span> <span style="color:#007020;font-weight:bold">nil</span> {
		<span style="color:#007020">panic</span>(err)
	}

	_, err = WSConn.Write([]<span style="color:#007020">byte</span>(s))
	<span style="color:#007020;font-weight:bold">if</span> err <span style="color:#666">!=</span> <span style="color:#007020;font-weight:bold">nil</span> {
		<span style="color:#007020">panic</span>(err)
	}

	buf <span style="color:#666">:=</span> <span style="color:#007020">make</span>([]<span style="color:#902000">byte</span>, <span style="color:#40a070">1024</span>)
	<span style="color:#60a0b0;font-style:italic">// Wrap call in goroutine to use blocking code
</span><span style="color:#60a0b0;font-style:italic"></span>	<span style="color:#007020;font-weight:bold">go</span> <span style="color:#007020;font-weight:bold">func</span>() {
		<span style="color:#60a0b0;font-style:italic">// Blocks until a WebSocket frame is received
</span><span style="color:#60a0b0;font-style:italic"></span>		n, err <span style="color:#666">:=</span> WSConn.Read(buf)
		<span style="color:#007020;font-weight:bold">if</span> err <span style="color:#666">!=</span> <span style="color:#007020;font-weight:bold">nil</span> {
			<span style="color:#007020">panic</span>(err)
		}

		m.BidiMessages = <span style="color:#007020">append</span>(m.BidiMessages, getStreamMessage(<span style="color:#007020">string</span>(buf[:n])))
	}()
}</code></pre>
</div>
<p>In this, we have separate functions for connecting to the WebSocket,
sending and reading a message, and closing the WebSocket. We use another
excellent GopherJS package, the <a href="https://github.com/gopherjs/websocket">websocket</a>
wrapper for working with the browsers native websockets. The <code>Send</code> function
takes the text from the form input, marshals it to JSON and sends it on the websocket.
It then reads until it gets a reply. Obviously this can be designed differently
if we need different behaviour.</p>

<p>Now that we&rsquo;ve finished the client, we need to put everything together.</p>

      </article>

      <div class="addthis_inline_share_toolbox"></div>

      <ul class="pager blog-pager">
        
          <li class="previous">
            <a href="https://jbrandhorst.com/post/gopherjs-client-grpc-server-2/" data-toggle="tooltip" data-placement="top" title="GopherJS Client and gRPC Server - Part 2">&larr; Previous Post</a>
          </li>
        
        
          <li class="next">
            <a href="https://jbrandhorst.com/post/gopherjs-client-grpc-server-4/" data-toggle="tooltip" data-placement="top" title="GopherJS Client and gRPC Server - Part 4">Next Post &rarr;</a>
          </li>
        
      </ul>

      
        
      

    </div>
  </div>
</div>

    <footer>
  <div class="container">
    <div class="row">
      <div class="col-lg-8 col-lg-offset-2 col-md-10 col-md-offset-1">
        <ul class="list-inline text-center footer-links">
          
              <li>
                <a href="https://github.com/johanbrandhorst" title="GitHub">
                  <span class="fa-stack fa-lg">
                    <i class="fa fa-circle fa-stack-2x"></i>
                    <i class="fa fa-github fa-stack-1x fa-inverse"></i>
                  </span>
                </a>
              </li>
              <li>
                <a href="https://twitter.com/JohanBrandhorst" title="Twitter">
                  <span class="fa-stack fa-lg">
                    <i class="fa fa-circle fa-stack-2x"></i>
                    <i class="fa fa-twitter fa-stack-1x fa-inverse"></i>
                  </span>
                </a>
              </li>
              <li>
                <a href="https://linkedin.com/in/johan-brandhorst-satzkorn-aa318220" title="LinkedIn">
                  <span class="fa-stack fa-lg">
                    <i class="fa fa-circle fa-stack-2x"></i>
                    <i class="fa fa-linkedin fa-stack-1x fa-inverse"></i>
                  </span>
                </a>
              </li>
          
          <li>
            <a href="https://jbrandhorst.com/index.xml" title="RSS">
              <span class="fa-stack fa-lg">
                <i class="fa fa-circle fa-stack-2x"></i>
                <i class="fa fa-rss fa-stack-1x fa-inverse"></i>
              </span>
            </a>
          </li>
          
        </ul>
        <p class="credits copyright text-muted">
          Johan Brandhorst
          &nbsp;&bull;&nbsp;
          2017

          
            &nbsp;&bull;&nbsp;
            <a href="https://jbrandhorst.com">Go Ahead</a>
          
        </p>
        
        <p class="credits theme-by text-muted">
          <a href="http://gohugo.io">Hugo v0.28</a> powered &nbsp;&bull;&nbsp; <a href="https://github.com/halogenica/beautifulhugo">Beautiful Hugo</a> &nbsp;&bull;&nbsp; Thanks to <a href="https://netlify.com">Netlify.com</a> for hosting my blog!
          
        </p>
      </div>
    </div>
  </div>
</footer>

<script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.7.1/katex.min.js" integrity="sha384-/y1Nn9+QQAipbNQWU65krzJralCnuOasHncUFXGkdwntGeSvQicrYkiUBwsgUqc1" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.7.1/contrib/auto-render.min.js" integrity="sha384-dq1/gEHSxPZQ7DdrM82ID4YVol9BYyU7GbWlIwnwyPzotpoc57wDw/guX8EaYGPx" crossorigin="anonymous"></script>
<script src="https://code.jquery.com/jquery-1.12.4.min.js" integrity="sha256-ZosEbRLbNQzLpnKIkEdrPv7lOy9C27hHQ+Xp8a4MxAQ=" crossorigin="anonymous"></script>
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
<script src="https://jbrandhorst.com/js/main.js"></script>
<script> renderMathInElement(document.body); </script>



<script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-593054e035fc0c92" async></script>


  </body>
</html>

